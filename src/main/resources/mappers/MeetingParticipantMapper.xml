<?xml version="1.0" encoding="UTF-8"?>
<!-- 작성자: 배지원 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sys.stm.domains.meeting.dao.MeetingParticipantRepository">



    <!-- ID에 따른 Entity 조회 -->
    <select id="getParticipantById" parameterType="long" resultType="com.sys.stm.domains.meeting.domain.MeetingParticipant">
        SELECT
            *
        FROM
            "meeting_participant"
        WHERE "id" = #{id}
    </select>

    <!-- 참석자 생성 -->
    <insert id="createParticipant" parameterType="com.sys.stm.domains.meeting.domain.MeetingParticipant">
        INSERT INTO "meeting_participant"("meeting_id", "member_id", "created_at", "updated_at", "is_deleted")
        VALUES (#{meetingId}, #{memberId}, #{createdAt}, #{updatedAt}, #{isDeleted})
    </insert>

    <!-- 회의 ID 목록으로 참석자 배치 조회 -->
    <select id="findByMeetingIds" parameterType="java.util.List" resultType="com.sys.stm.domains.meeting.domain.MeetingParticipant">
        SELECT
        "id",
        "meeting_id" as meetingId,
        "member_id" as memberId,
        "created_at" as createdAt,
        "updated_at" as updatedAt,
        "is_deleted" as isDeleted
        FROM "meeting_participant"
        WHERE "meeting_id" IN
        <foreach collection="list" item="meetingId" open="(" separator="," close=")">
            #{meetingId}
        </foreach>
        AND "is_deleted" = 0
        ORDER BY "meeting_id", "created_at" ASC
    </select>


    <delete id="deleteMeetingParticipant" parameterType="com.sys.stm.domains.meeting.domain.MeetingParticipant">
        UPDATE "meeting_participant"
        SET
            "is_deleted" = #{isDeleted},
            "updated_at" = #{updatedAt}
        WHERE "id" = #{id}
    </delete>

    <delete id="deleteMeetingParticipantFromMeetingId" parameterType="com.sys.stm.domains.meeting.domain.MeetingParticipant">
        UPDATE "meeting_participant"
        SET
            "is_deleted" = #{isDeleted},
            "updated_at" = #{updatedAt}
        WHERE "meeting_id" = #{meetingId}
    </delete>
</mapper>
