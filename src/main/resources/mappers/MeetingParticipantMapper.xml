<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sys.stm.domains.meeting.dao.MeetingParticipantRepository">

    <!-- 참석자 생성 -->
    <insert id="createParticipant" parameterType="com.sys.stm.domains.meeting.domain.MeetingParticipant">
        INSERT INTO "meeting_participant"("meeting_id", "member_id", "created_at", "updated_at", "is_deleted")
        VALUES (#{meetingId}, #{memberId}, #{createdAt}, #{updatedAt}, #{isDeleted})
    </insert>

    <!-- 회의 ID 목록으로 참석자 배치 조회 -->
    <select id="findByMeetingIds" parameterType="java.util.List" resultType="com.sys.stm.domains.meeting.domain.MeetingParticipant">
        SELECT
        "id",
        "meeting_id" as meetingId,
        "member_id" as memberId,
        "created_at" as createdAt,
        "updated_at" as updatedAt,
        "is_deleted" as isDeleted
        FROM "meeting_participant"
        WHERE "meeting_id" IN
        <foreach collection="list" item="meetingId" open="(" separator="," close=")">
            #{meetingId}
        </foreach>
        AND "is_deleted" = 0
        ORDER BY "meeting_id", "created_at" ASC
    </select>
<!--    &lt;!&ndash; 회의별 참석자 목록 조회 &ndash;&gt;-->
<!--    <select id="findByMeetingId" parameterType="long" resultType="com.sys.stm.domains.meeting.domain.MeetingParticipant">-->
<!--        SELECT "id",-->
<!--            "meeting_id",-->
<!--            "member_id",-->
<!--            "created_at",-->
<!--            "updated_at",-->
<!--            "is_deleted"-->
<!--        FROM "participant"-->
<!--        WHERE "meeting_id" = #{meetingId} AND "is_deleted" = 0-->
<!--        ORDER BY "created_at" ASC-->
<!--    </select>-->

<!--    &lt;!&ndash; 참석자 조회 (ID로) &ndash;&gt;-->
<!--    <select id="findById" parameterType="long" resultType="com.sys.stm.domains.meeting.domain.MeetingParticipant">-->
<!--        SELECT-->
<!--            "id",-->
<!--            "meeting_id",-->
<!--            "member_id",-->
<!--            "created_at",-->
<!--            "updated_at",-->
<!--            "is_deleted"-->
<!--        FROM "participant"-->
<!--        WHERE "id" = #{id} AND "is_deleted" = 0-->
<!--    </select>-->

<!--    &lt;!&ndash; 참석자 수정 &ndash;&gt;-->
<!--    <update id="updateParticipant" parameterType="com.sys.stm.domains.meeting.domain.MeetingParticipant">-->
<!--        UPDATE "participant"-->
<!--        SET-->
<!--            "updated_at" = #{updatedAt}-->
<!--        WHERE "id" = #{id} AND "is_deleted" = 0-->
<!--    </update>-->

<!--    &lt;!&ndash; 참석자 삭제 (논리 삭제) &ndash;&gt;-->
<!--    <update id="deleteParticipant" parameterType="long">-->
<!--        UPDATE "participant"-->
<!--        SET-->
<!--            "is_deleted" = 1,-->
<!--            "updated_at" = CURRENT_TIMESTAMP-->
<!--        WHERE "id" = #{id}-->
<!--    </update>-->

<!--    &lt;!&ndash; 회의별 참석자 수 조회 &ndash;&gt;-->
<!--    <select id="countByMeetingId" parameterType="long" resultType="int">-->
<!--        SELECT COUNT(*)-->
<!--        FROM "participant"-->
<!--        WHERE "meeting_id" = #{meetingId} AND "is_deleted" = 0-->
<!--    </select>-->
</mapper>
